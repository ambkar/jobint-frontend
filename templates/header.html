<header class="jobint-header">
  <div class="header-left">
    <span class="logo">Jobint</span>
  </div>

  <nav class="header-nav">
    <a href="/"          class="nav-btn" id="navMain">–ì–ª–∞–≤–Ω–∞—è</a>
    <a href="/panel"     class="nav-btn" id="navCompanies">–û –∫–æ–º–ø–∞–Ω–∏–∏</a>
    <a href="/analytics" class="nav-btn" id="navAnalytics">–ê–Ω–∞–ª–∏—Ç–∏–∫–∞</a>
    <a href="/invoices"  class="nav-btn" id="navInvoices">–°—á–µ—Ç–∞</a>
    <a href="/calendar"  class="nav-btn" id="navCalendar">–ö–∞–ª–µ–Ω–¥–∞—Ä—å</a>
  </nav>

  <div class="header-right">
    <div class="user-info" id="userInfoBlock" tabindex="0">
      <div class="user-avatar"  id="headerUserAvatar"  style="display:none"><span>üë§</span></div>
      <div class="user-details" id="headerUserDetails" style="display:none">
        <div class="user-name"  id="headerUserName"></div>
        <div class="user-email" id="headerUserEmail"></div>
      </div>

      <div class="user-dropdown" id="userDropdown" style="display:none">
        <a href="/profile" class="dropdown-item">–ü—Ä–æ—Ñ–∏–ª—å</a>
        <a href="#"        class="dropdown-item" id="logoutLink">–í—ã–π—Ç–∏</a>
      </div>

      <div class="guest-buttons" id="guestButtons" style="display:flex">
        <a href="/login"    class="header-btn">–í—Ö–æ–¥</a>
        <a href="/register" class="header-btn header-btn--primary">–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</a>
      </div>
    </div>
  </div>
</header>

<style>
.jobint-header {
  position: fixed;
  top: 0; left: 0; width: 100%; height: 82px;
  background: #fff;
  display: flex; align-items: center; justify-content: space-between;
  padding: 0 38px;
  box-sizing: border-box;
  z-index: 100;
  border-bottom: 1.5px solid #f1f3f6;
  font-family: 'Actay', Arial, sans-serif;
}
.header-left { display: flex; align-items: center; min-width: 160px; }
.logo {
  font-family: 'Actay Wide', Arial, sans-serif;
  font-weight: 700;
  font-size: 2rem;
  letter-spacing: -1px;
  color: #2962ff;
  background: linear-gradient(90deg,#2962ff 60%,#1a1a1a 100%);
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
}
.header-nav {
  position: absolute; left: 50%; top: 0; height: 100%;
  display: flex; align-items: center; gap: 10px;
  transform: translateX(-50%);
  z-index: 2;
}
.header-nav .nav-btn {
  display: inline-block;
  padding: 8px 22px;
  border-radius: 22px;
  font-size: 1.09rem;
  color: #3b3e4a;
  text-decoration: none;
  font-weight: 500;
  font-family: 'Actay Wide', Arial, sans-serif;
  transition: background .14s, color .14s;
}
.header-nav .nav-btn.active,
.header-nav .nav-btn:hover {
  background: #eaf1ff;
  color: #2962ff;
}
.header-right { display: flex; align-items: center; gap: 18px; min-width: 180px; }
.user-info {
  display: flex; align-items: center; gap: 12px; position: relative; cursor: pointer; outline: none;
}
.user-avatar {
  width: 48px; height: 48px; border-radius: 50%;
  background: #e3e7ef;
  display: flex; align-items: center; justify-content: center;
  font-size: 2rem; color: #bfc9dc;
  overflow: hidden;
  box-shadow: 0 2px 8px rgba(41,98,255,0.07);
  border: 2px solid #eaf1ff;
  transition: border 0.13s;
}
.user-avatar img {
  width: 100%; height: 100%; border-radius: 50%; object-fit: cover;
}
.user-details {
  display: flex; flex-direction: column; line-height: 1.1;
  font-family: 'Actay', Arial, sans-serif;
}
.user-name {
  font-weight: 700; font-size: 1.09rem; color: #222;
  font-family: 'Actay Wide', Arial, sans-serif;
}
.user-email {
  font-size: .97rem; color: #8a8e99;
}
.user-dropdown {
  display: none;
  position: absolute; top: 100%; right: 0; min-width: 170px;
  background: #fff;
  box-shadow: 0 4px 22px rgba(41,98,255,0.12);
  border-radius: 14px;
  padding: 10px 0;
  z-index: 20;
  flex-direction: column;
  transition: opacity .12s;
  overflow: hidden;
  font-family: 'Actay', Arial, sans-serif;
}
.user-dropdown .dropdown-item {
  display: block; width: 100%;
  padding: 10px 22px;
  color: #2a2c36;
  text-decoration: none;
  font-size: 1.07rem;
  border: none; background: none;
  text-align: left; cursor: pointer;
  transition: background .13s;
  border-radius: 0;
  font-family: 'Actay', Arial, sans-serif;
}
.user-dropdown .dropdown-item:hover {
  background: #f2f7ff; color: #2962ff; text-decoration: none;
}
.guest-buttons {
  display: flex; gap: 10px; align-items: center; margin-left: 8px;
}
.header-btn {
  display: inline-block;
  padding: 8px 18px;
  border-radius: 13px;
  font-size: 1rem;
  color: #2962ff;
  background: #eaf1ff;
  text-decoration: none;
  font-weight: 700;
  border: none;
  transition: background .14s, color .14s;
  cursor: pointer;
  font-family: 'Actay Wide', Arial, sans-serif;
}
.header-btn:hover { background: #d0e3ff; color: #1b2fa0; }
.header-btn--primary { background: #2962ff; color: #fff; }
.header-btn--primary:hover { background: #1b2fa0; color: #fff; }
@media(max-width:900px){
  .jobint-header{padding:0 8px;}
  .header-nav .nav-btn{padding:6px 10px;font-size:1rem;}
  .header-left,.header-right{min-width:70px;}
  .logo{font-size:1.2rem;}
}
</style>

<script>
function setActiveNav(){
  const p=location.pathname;
  document.querySelectorAll('.header-nav .nav-btn').forEach(b=>b.classList.remove('active'));
  if(p==='/')                        navMain.classList.add('active');
  else if(p.startsWith('/panel'))    navCompanies.classList.add('active');
  else if(p.startsWith('/analytics'))navAnalytics.classList.add('active');
  else if(p.startsWith('/invoices')) navInvoices.classList.add('active');
  else if(p.startsWith('/calendar')) navCalendar.classList.add('active');
}

async function updateHeaderUser(){
  const token = localStorage.getItem('jwt_token');
  const avatarDiv  = document.getElementById('headerUserAvatar');
  const nameDiv    = document.getElementById('headerUserName');
  const emailDiv   = document.getElementById('headerUserEmail');
  const userDrop   = document.getElementById('userDropdown');
  const guestBtns  = document.getElementById('guestButtons');
  const detailsDiv = document.getElementById('headerUserDetails');

  if(!token){
    avatarDiv.style.display = detailsDiv.style.display = userDrop.style.display = "none";
    guestBtns.style.display = "flex";
    return;
  }
  try{
    const r = await fetch('/api/v1/auth/me',{headers:{Authorization:'Bearer '+token}});
    if(r.status===401) throw new Error('unauth');
    const {user} = await r.json();

    nameDiv.textContent  = `${user.surname} ${user.name}`.trim();
    emailDiv.textContent = user.email || '';

    avatarDiv.innerHTML  = user.id
        ? `<img src="/user/avatar/${user.id}?t=${Date.now()}" alt="avatar">`
        : '<span>üë§</span>';

    avatarDiv.style.display  =
    detailsDiv.style.display = '';
    userDrop.style.display   = '';
    guestBtns.style.display  = 'none';

    document.getElementById('logoutLink').onclick = e=>{
      e.preventDefault();
      localStorage.removeItem('jwt_token');
      location.href='/login';
    };
  }catch{
    avatarDiv.style.display = detailsDiv.style.display = userDrop.style.display = "none";
    guestBtns.style.display = "flex";
  }
}

document.addEventListener('DOMContentLoaded',()=>{
  setActiveNav();
  updateHeaderUser();

  const info = document.getElementById('userInfoBlock');
  const drop = document.getElementById('userDropdown');
  let t=null;
  const show=()=>{clearTimeout(t);if(drop.style.display!=='none')drop.style.display='flex'};
  const hide=()=>{t=setTimeout(()=>{if(drop.style.display!=='none')drop.style.display=''},120)};
  info.addEventListener('mouseenter',show);
  info.addEventListener('mouseleave',hide);
  drop.addEventListener('mouseenter',show);
  drop.addEventListener('mouseleave',hide);
});
</script>
