{% extends "null.html" %}
{% block title %}Вход{% endblock %}
{% block content %}
<div class="flex-container">
  <div class="left-panel">
    <img src="https://www.cryptopolitan.com/wp-content/uploads/2024/01/DALL·E-2024-01-22-12.58.44-A-lifelike-image-of-a-robot-calculating-the-cost-of-GAI-General-Artificial-Intelligence-on-a-calculator-in-an-office-setting.-The-robot-is-designed-.jpg" alt="AI Assistant" />
  </div>
  <div class="right-panel">
    <div class="form-container">
      <div class="brand-title">HR : Assistant</div>
      <div class="brand-subtitle">Рады видеть вас снова!</div>
      <form id="loginForm" class="form">
        <div>
          <label for="email">Логин</label>
          <input type="email" id="email" name="email" required placeholder="Email">
        </div>
        <div>
          <label for="password">Пароль</label>
          <input type="password" id="password" name="password" required placeholder="Пароль">
        </div>
        <div class="forgot-link">
          <a href="/forgot-password">Забыли пароль?</a>
        </div>
        <button type="submit">Войти</button>
      </form>
      <div id="error" class="error-message"></div>
      <div class="register-link">
        Вы здесь впервые? <a href="/register">Зарегистрироваться</a>
      </div>
    </div>
  </div>
</div>
<script>
  document.getElementById('loginForm').onsubmit = async function(e) {
    e.preventDefault();
    const form = e.target;
    const data = {
      email: form.email.value,
      password: form.password.value
    };
    const res = await fetch('/auth/login', {
      method: 'POST',
      headers: {'Content-Type': 'application/json'},
      body: JSON.stringify(data)
    });
    let json;
    try {
      json = await res.json();
    } catch (err) {
      json = {};
    }
    if (res.ok && json.token) {
      localStorage.setItem('jwt_token', json.token);
      window.location.href = '/';
    } else {
      document.getElementById('error').textContent = json.error || 'Ошибка входа';
    }
  };
</script>
{% endblock %}
